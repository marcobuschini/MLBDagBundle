language: php

php:
  - 7.0
  - 7.1
  - hhvm

env:
  - SYMFONY_VERSION="2.8.*" PHPUNIT_BRIDGE=true
  - SYMFONY_VERSION="3.4.*" PHPUNIT_BRIDGE=true
  - SYMFONY_VERSION="4.0.*" PHPUNIT_BRIDGE=true
  - SYMFONY_VERSION="4.1.*" PHPUNIT_BRIDGE=true

global:
  - CC_TEST_REPORTER_ID=c430b1e8e2a68d4ec24751557f6dcf822a1c5de477d6059dc4f915414359f3f0

matrix:
  allow_failures:
    - php: hhvm
    - env: SYMFONY_VERSION="4.0.*" PHPUNIT_BRIDGE=true"
    - env: SYMFONY_VERSION="4.1.*" PHPUNIT_BRIDGE=true"
  fast_finish: true

before_script:
  - composer self-update
  - composer require symfony/symfony:${SYMFONY_VERSION} --no-update
  - composer install --prefer-source
  - mysql -e "create database IF NOT EXISTS test;" -uroot
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 >./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - ./cc-test-reporter before-build

script:
  - mkdir -p build/logs
  - phpunit -c phpunit.xml.dist

after_script:
  - ./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT

after_success:
  - ./cc-test-reporter upload-coverage
  - travis_retry php vendor/bin/coveralls -v
  - bash <(curl -s https://codecov.io/bash)
